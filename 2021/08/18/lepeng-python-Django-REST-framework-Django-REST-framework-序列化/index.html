<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <script data-ad-client="ca-pub-2488174175014870" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <!-- google ad -->
    <meta name="google-site-verification" content="40lMg4eqLLbXoDcpN3h-cEnfmselbQ8tUzNvuC0IRIs" /><!-- google 站点认证 -->
    <meta name="baidu-site-verification" content="093lY4ziMu" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="description" content="A hexo theme">
    <meta name="keyword"  content="hexo, hexo-theme-lp">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!--<link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>-->
    <title>
        
          Django REST framework 序列化 - Hexo-theme-lp
        
    </title>

    <link rel="canonical" href="https://flepeng.github.io/2021/08/18/lepeng-python-Django-REST-framework-Django-REST-framework-序列化/">

    <!-- Bootstrap Core CSS -->
    
<link rel="stylesheet" href="/css/bootstrap.min.css">


    <!-- Custom CSS --> 
    
        
<link rel="stylesheet" href="/css/dusign-light.css">

        
<link rel="stylesheet" href="/css/dusign-common-light.css">

        
<link rel="stylesheet" href="/css/font-awesome.css">

        
<link rel="stylesheet" href="/css/toc.css">

        <!-- background effects end -->
    
    
    <!-- Pygments Highlight CSS -->
    
<link rel="stylesheet" href="/css/highlight.css">


    
<link rel="stylesheet" href="/css/widget.css">


    
<link rel="stylesheet" href="/css/rocket.css">


    
<link rel="stylesheet" href="/css/signature.css">


    
<link rel="stylesheet" href="/css/fonts.googleapis.css">


    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">

    <!-- photography -->
    
<link rel="stylesheet" href="/css/photography.css">


    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 4.2.1"></head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- background effects start -->
    
    <!-- background effects end -->

	<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            
                background-image: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), url('/img/header_img/archive-bg.jpg')
                /*post*/
            
        
    }
    
    #signature{
        background-image: url('/img/signature/dusign.png');
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#Python" title="Python">Python</a>
                            
                              <a class="tag" href="/tags/#Django" title="Django">Django</a>
                            
                              <a class="tag" href="/tags/#DRF" title="DRF">DRF</a>
                            
                        </div>
                        <h1>Django REST framework 序列化</h1>
                        <h2 class="subheading"></h2>
                        <span class="meta">
                            Posted by Lepeng on
                            2021-08-18
                        </span>

                        
                            <div class="blank_box"></div>
                            <span class="meta">
                                Words <span class="post-count">6.3k</span> and
                                Reading Time <span class="post-count">30</span> Minutes
                            </span>
                            <div class="blank_box"></div>
                            <!-- 不蒜子统计 start -->
                            <span class="meta">
                                Viewed <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span> Times
                            </span>
                            <!-- 不蒜子统计 end -->
                        

                    </div>
                

                </div>
            </div>
        </div>      
    </div>

    
    <div class="waveWrapper">
        <div class="wave wave_before" style="background-image: url('/img/wave-light.png')"></div>
        <div class="wave wave_after" style="background-image: url('/img/wave-light.png')"></div>
    </div>
    
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Lepeng</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/categories/">Categories</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                    
                    <li>
                        <a href="http://flepeng.com" target="_blank">chinese_blog</a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>使用序列化有四种方式</p>
<ul>
<li><strong>使用json模块，完全手写</strong></li>
<li><strong>使用django自带的序列化模块<br>1，# from django.core import serializers<br>2，# data=serializers.serialize(“json”,book_list)</strong></li>
<li><strong>使用REST framework 带的序列化方法，但是自己写规则<br>BookSerializers(serializers.Serializer)</strong></li>
<li><strong>使用REST framework 带的序列化方法，不自定义，完全使用模块<br>BookSerializers(serializers.ModelSerializer)</strong></li>
</ul>
<p>开发我们的Web API的第一件事是为我们的Web API提供一种将代码片段实例序列化和反序列化为诸如<code>json</code>之类的表示形式的方式。我们可以通过声明与Django forms非常相似的序列化器（serializers）来实现。</p>
<h2 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h2><h3 id="models部分"><a href="#models部分" class="headerlink" title="models部分:"></a>models部分:</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    title=models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    price=models.IntegerField()</span><br><span class="line">    pub_date=models.DateField()</span><br><span class="line">    publish=models.ForeignKey(<span class="string">"Publish"</span>)</span><br><span class="line">    authors=models.ManyToManyField(<span class="string">"Author"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.title</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Publish</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name=models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    email=models.EmailField()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name=models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    age=models.IntegerField()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br></pre></td></tr></table></figure>
<h3 id="views部分："><a href="#views部分：" class="headerlink" title="views部分："></a>views部分：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookViewSet</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request,*args,**kwargs)</span>:</span></span><br><span class="line">        book_list=Book.objects.all()</span><br><span class="line">        <span class="comment"># 序列化方式1 自己手写json:</span></span><br><span class="line">        <span class="comment"># from django.forms.models import model_to_dict</span></span><br><span class="line">        <span class="comment"># import json</span></span><br><span class="line">        <span class="comment"># data=[]</span></span><br><span class="line">        <span class="comment"># for obj in book_list:</span></span><br><span class="line">        <span class="comment">#     data.append(model_to_dict(obj))</span></span><br><span class="line">        <span class="comment"># print(data)</span></span><br><span class="line">        <span class="comment"># return HttpResponse("ok")</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 序列化方式2，使用django自带的序列化模块:</span></span><br><span class="line">        <span class="comment"># from django.core import serializers</span></span><br><span class="line">        <span class="comment"># data=serializers.serialize("json",book_list)</span></span><br><span class="line">        <span class="comment"># return HttpResponse(data)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 序列化方式3，使用REST framework 带的序列化方法，但是自己写规则:</span></span><br><span class="line">        bs=BookSerializers(book_list,many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(bs.data)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 序列化方式4，使用REST framework 带的序列化方法，不自定义，完全使用模块，如下</span></span><br><span class="line">        bs=BookSerializers(book_list,many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(bs.data)</span><br></pre></td></tr></table></figure>
<h3 id="方式三：BookSerializers"><a href="#方式三：BookSerializers" class="headerlink" title="方式三：BookSerializers"></a>方式三：BookSerializers</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.core <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookSerializers</span><span class="params">(serializers.Serializer)</span>:</span>            <span class="comment"># 方式三，自己定义序列化的规则</span></span><br><span class="line">    title=serializers.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    price=serializers.IntegerField()</span><br><span class="line">    pub_date=serializers.DateField()</span><br><span class="line">    publish=serializers.CharField(source=<span class="string">"publish.name"</span>)  <span class="comment"># 一对多，序列化时如果想要指定字段，需要使用参数source，跨表用.</span></span><br><span class="line">    <span class="comment">#authors=serializers.CharField(source="authors.all")</span></span><br><span class="line">    authors=serializers.SerializerMethodField()           <span class="comment"># 多对多时，自定义字段字段</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_authors</span><span class="params">(self,obj)</span>:</span>   <span class="comment"># 名字固定写法</span></span><br><span class="line">        temp=[]</span><br><span class="line">        <span class="keyword">for</span> author <span class="keyword">in</span> obj.authors.all():</span><br><span class="line">            temp.append(author.name)</span><br><span class="line">        <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model=Book </span><br><span class="line">        fields=[<span class="string">'title'</span>,<span class="string">'price'</span>,<span class="string">'pub_date'</span>,<span class="string">'authors'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 钩子函数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate_title</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'草'</span> <span class="keyword">in</span> value:</span><br><span class="line">            <span class="keyword">raise</span> serializers.ValidationError(<span class="string">'不符合社会主义核心价值观'</span>)</span><br><span class="line">        <span class="keyword">return</span> value</span><br></pre></td></tr></table></figure>
<h3 id="方式四：ModelSerializer"><a href="#方式四：ModelSerializer" class="headerlink" title="方式四：ModelSerializer"></a>方式四：ModelSerializer</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ModelSerializer 继承自 Serializer</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookSerializers</span><span class="params">(serializers.ModelSerializer)</span>:</span>       <span class="comment"># 不自定义，完全使用模块</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span> <span class="comment">#固定写法</span></span><br><span class="line">        <span class="comment"># 指定要序列化Book表</span></span><br><span class="line">        model = models.Book</span><br><span class="line">        <span class="comment">#指定要序列化的字段</span></span><br><span class="line">        fields = [<span class="string">'nid'</span>,<span class="string">'name'</span>]</span><br><span class="line">        <span class="comment">#序列化所有字段</span></span><br><span class="line">        fileds =<span class="string">'__all__'</span></span><br><span class="line">        <span class="comment">#要排除的字段（不能与fileds连用）</span></span><br><span class="line">        <span class="comment"># exclude = ['name','price'] </span></span><br><span class="line">        <span class="comment">#深度判定</span></span><br><span class="line">        depth = <span class="number">1</span> </span><br><span class="line">        <span class="comment">#如果要不按照父类的来，想要自己定义显示的字段的话,自己定义一个，覆盖掉父类的字段属性。</span></span><br><span class="line">    publish = serializers.SerializerMethodField()  <span class="comment">#一对多字段</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_publish</span><span class="params">(self,obj)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">'id'</span>:obj.publish.pk,<span class="string">'name'</span>:obj.publish.name&#125;</span><br></pre></td></tr></table></figure>
<h2 id="序列化组件常用字段"><a href="#序列化组件常用字段" class="headerlink" title="序列化组件常用字段"></a>序列化组件常用字段</h2><p><strong>常用字段类型</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>字段</th>
<th>字段构造方式</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>BooleanField</strong></td>
<td>BooleanField()</td>
</tr>
<tr>
<td><strong>NullBooleanField</strong></td>
<td>NullBooleanField()</td>
</tr>
<tr>
<td><strong>CharField</strong></td>
<td>CharField(max_length=None, min_length=None, allow_blank=False, trim_whitespace=True)</td>
</tr>
<tr>
<td><strong>EmailField</strong></td>
<td>EmailField(max_length=None, min_length=None, allow_blank=False)</td>
</tr>
<tr>
<td><strong>RegexField</strong></td>
<td>RegexField(regex, max_length=None, min_length=None, allow_blank=False)</td>
</tr>
<tr>
<td><strong>SlugField</strong></td>
<td>SlugField(maxlength=50, min_length=None, allow_blank=False) 正则字段，验证正则模式 [a-zA-Z0-9-]+</td>
</tr>
<tr>
<td><strong>URLField</strong></td>
<td>URLField(max_length=200, min_length=None, allow_blank=False)</td>
</tr>
<tr>
<td><strong>UUIDField</strong></td>
<td>UUIDField(format=’hex_verbose’)  &lt;/br&gt;format:  &lt;/br&gt;1) ‘hex_verbose’ 如”5ce0e9a5-5ffa-654b-cee0-1238041fb31a”  &lt;/br&gt;2） ‘hex’ 如 “5ce0e9a55ffa654bcee01238041fb31a”  &lt;/br&gt;3）’int’ - 如: “123456789012312313134124512351145145114”  &lt;/br&gt;4）’urn’ 如: “urn:uuid:5ce0e9a5-5ffa-654b-cee0-1238041fb31a”</td>
</tr>
<tr>
<td><strong>IPAddressField</strong></td>
<td>IPAddressField(protocol=’both’, unpack_ipv4=False, **options)</td>
</tr>
<tr>
<td><strong>IntegerField</strong></td>
<td>IntegerField(max_value=None, min_value=None)</td>
</tr>
<tr>
<td><strong>FloatField</strong></td>
<td>FloatField(max_value=None, min_value=None)</td>
</tr>
<tr>
<td><strong>DecimalField</strong></td>
<td>DecimalField(max_digits, decimal_places, coerce_to_string=None, max_value=None, min_value=None)  &lt;/br&gt;max_digits: 最多位数  &lt;/br&gt;decimal_palces: 小数点位置</td>
</tr>
<tr>
<td><strong>DateTimeField</strong></td>
<td>DateTimeField(format=api_settings.DATETIME_FORMAT, input_formats=None)</td>
</tr>
<tr>
<td><strong>DateField</strong></td>
<td>DateField(format=api_settings.DATE_FORMAT, input_formats=None)</td>
</tr>
<tr>
<td><strong>TimeField</strong></td>
<td>TimeField(format=api_settings.TIME_FORMAT, input_formats=None)</td>
</tr>
<tr>
<td><strong>DurationField</strong></td>
<td>DurationField()</td>
</tr>
<tr>
<td><strong>ChoiceField</strong></td>
<td>ChoiceField(choices)  &lt;/br&gt; choices与Django的用法相同</td>
</tr>
<tr>
<td><strong>MultipleChoiceField</strong></td>
<td>MultipleChoiceField(choices)</td>
</tr>
<tr>
<td><strong>FileField</strong></td>
<td>FileField(max_length=None, allow_empty_file=False, use_url=UPLOADED_FILES_USE_URL)</td>
</tr>
<tr>
<td><strong>ImageField</strong></td>
<td>ImageField(max_length=None, allow_empty_file=False, use_url=UPLOADED_FILES_USE_URL)</td>
</tr>
<tr>
<td><strong>ListField</strong></td>
<td>ListField(child=, min_length=None, max_length=None)</td>
</tr>
<tr>
<td><strong>DictField</strong></td>
<td>DictField(child=)</td>
</tr>
</tbody>
</table>
</div>
<p><strong>选项参数：</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>名称</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>max_length</strong></td>
<td>最大长度</td>
</tr>
<tr>
<td><strong>min_lenght</strong></td>
<td>最小长度</td>
</tr>
<tr>
<td><strong>allow_blank</strong></td>
<td>是否允许为空</td>
</tr>
<tr>
<td><strong>trim_whitespace</strong></td>
<td>是否截断空白字符</td>
</tr>
<tr>
<td><strong>max_value</strong></td>
<td>最大值</td>
</tr>
<tr>
<td><strong>min_value</strong></td>
<td>最小值</td>
</tr>
</tbody>
</table>
</div>
<p><strong>通用参数</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>参数名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>read_only</strong></td>
<td>表明该字段仅用于序列化输出，默认False</td>
</tr>
<tr>
<td><strong>write_only</strong></td>
<td>表明该字段仅用于反序列化输入，默认False</td>
</tr>
<tr>
<td><strong>required</strong></td>
<td>表明该字段在反序列化时必须输入，默认True</td>
</tr>
<tr>
<td><strong>default</strong></td>
<td>反序列化时使用的默认值</td>
</tr>
<tr>
<td><strong>allow_null</strong></td>
<td>表明该字段是否允许传入None，默认False</td>
</tr>
<tr>
<td><strong>validators</strong></td>
<td>该字段使用的验证器</td>
</tr>
<tr>
<td><strong>error_messages</strong></td>
<td>包含错误编号与错误信息的字典</td>
</tr>
<tr>
<td><strong>label</strong></td>
<td>用于HTML展示API页面时，显示的字段名称</td>
</tr>
<tr>
<td><strong>help_text</strong></td>
<td>用于HTML展示API页面时，显示的字段帮助提示信息</td>
</tr>
</tbody>
</table>
</div>
<h2 id="source"><a href="#source" class="headerlink" title="source"></a>source</h2><p>在官方文档中是这样解释的：</p>
<blockquote>
<p>将用于填充字段的属性的名称。可以是仅接受<code>self</code>参数的方法，例如<code>URLField(source=&#39;get_absolute_url&#39;)</code>，也可以使用点分符号遍历属性，例如<code>EmailField(source=&#39;user.email&#39;)</code>。当使用点分符号序列化字段时，<code>default</code>如果在属性遍历期间任何对象不存在或为空，则可能需要提供一个值。<br>该值<code>source=&#39;*&#39;</code>具有特殊含义，用于指示应将整个对象传递给该字段。这对于创建嵌套表示或对需要访问完整对象才能确定输出表示的字段很有用。<br>默认为字段名称。</p>
</blockquote>
<p>其中比较常用的用法：</p>
<ol>
<li>source=”get_field_name_display”如上所展示，在choice字段中可以展示选项对应的解释，这中用法代表的是官方解释说的可以是仅接受<code>self</code>参数的方法，也就是source中可以填serializer对象可以调用的方法（方法中需要传入self），内在逻辑是这个字段会展示此方法的返回的结果。</li>
<li>source=’user.email’这种用法常在ModelSerializer的子类中，其中user为User对象，此中写法是指展示user的email属性，常用于我们想把外键对象user的属性和本对象的属性展示在同一层级，而不是下一级。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">class UserSerializer(serializers.Serializer):</span><br><span class="line">    type &#x3D; serializers.IntegerField(source&#x3D;&#39;user_type&#39;)</span><br><span class="line">    user_type &#x3D; serializers.CharField(source&#x3D;&#39;get_user_type_display&#39;)  # choices字段显示</span><br><span class="line">    username &#x3D; serializers.CharField()</span><br><span class="line">    pwd &#x3D; serializers.CharField(source&#x3D;&#39;password&#39;)  # 自定义serializer中的key值</span><br><span class="line">    group_title &#x3D; serializers.CharField(source&#x3D;&#39;group.title&#39;)  # 关联对象属性</span><br><span class="line">    roles &#x3D; serializers.CharField(source&#x3D;&#39;roles.all&#39;)  # 多对多关系</span><br><span class="line">    roles_info &#x3D; serializers.SerializerMethodField()   # 表示自定义方法，显示querytset对象详情</span><br><span class="line"></span><br><span class="line">    def get_roles_info(self, row):</span><br><span class="line">        roles &#x3D; row.roles.all()</span><br><span class="line">        ret &#x3D; []</span><br><span class="line">        for item in roles:</span><br><span class="line">            ret.append(</span><br><span class="line">                &#123;</span><br><span class="line">                    &#39;id&#39;: item.id,</span><br><span class="line">                    &#39;title&#39;: item.title</span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line">        return ret</span><br></pre></td></tr></table></figure>
<ol>
<li>如果没有指定在Filed中没有定义source参数的时候，就自动与数据库modles定义的字段进行匹配，如上面的userrname字段。在定义字段后，Serializer类中可以自定义属性如type</li>
<li>当models中是以choice定义时：需要定义source参数定义get_字段名_display才能获取数据，这与在模板语言中的用法一样，如上面的user_type</li>
<li>外键关联的时候，直接 外键字段名.属性 的方式定义传参给source参数即可，如上面的group.title</li>
<li>对于roles字段，想直接获取所有的对象，但是无法做到细粒度的将对象的所有属性展示出来，只能获取到QuerySet对象</li>
<li>自定义字段，处理数据，如roles<em>info获取所有的role对象的属性，处理数据可以定义方法，方法名格式为get</em>属性，并return值最终返回值</li>
</ol>
<h2 id="serializers-Serializer序列化"><a href="#serializers-Serializer序列化" class="headerlink" title="serializers.Serializer序列化"></a>serializers.Serializer序列化</h2><h3 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line">__all__ &#x3D; [&#39;Book&#39;, &#39;Publisher&#39;, &#39;Author&#39;]</span><br><span class="line">class Book(models.Model):</span><br><span class="line">    title &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line">    CHOICES &#x3D; (</span><br><span class="line">        (1, &#39;Python&#39;),</span><br><span class="line">        (2, &#39;Linux&#39;),</span><br><span class="line">        (3, &#39;Go&#39;)</span><br><span class="line">    )</span><br><span class="line">    category &#x3D; models.IntegerField(choices&#x3D;CHOICES)</span><br><span class="line">    pub_time &#x3D; models.DateField()</span><br><span class="line">    publisher &#x3D; models.ForeignKey(to &#x3D; &#39;Publisher&#39;, on_delete&#x3D;models.CASCADE)</span><br><span class="line">    authors &#x3D; models.ManyToManyField(to &#x3D; &#39;Author&#39;)</span><br><span class="line">    </span><br><span class="line">class Publisher(models.Model):</span><br><span class="line">    title &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line"></span><br><span class="line">class Author(models.Model):</span><br><span class="line">    name &#x3D; models.CharField(max_length&#x3D;32)</span><br></pre></td></tr></table></figure>
<h3 id="创建序列化器"><a href="#创建序列化器" class="headerlink" title="创建序列化器"></a>创建序列化器</h3><p>在app目录下创建serializers.py文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">from rest_framework import serializers</span><br><span class="line">from .models import Book</span><br><span class="line"></span><br><span class="line">class PublisherSerializer(serializers.Serializer):</span><br><span class="line">    id &#x3D; serializers.IntegerField()</span><br><span class="line">    title &#x3D; serializers.CharField(max_length&#x3D;32)</span><br><span class="line"></span><br><span class="line">class AutherSerializer(serializers.Serializer):</span><br><span class="line">    id &#x3D; serializers.IntegerField()</span><br><span class="line">    name &#x3D; serializers.CharField(max_length&#x3D;32)</span><br><span class="line"></span><br><span class="line">class BookSerializer(serializers.Serializer):</span><br><span class="line">    # required&#x3D;False 指明反序时（前端提交数据过来）不做校验</span><br><span class="line">    id &#x3D; serializers.IntegerField(required&#x3D;False)  </span><br><span class="line">    </span><br><span class="line">    title &#x3D; serializers.CharField(max_length&#x3D;32)</span><br><span class="line">    pub_time &#x3D; serializers.DateField()</span><br><span class="line">    </span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # source 比较常用的用法：</span><br><span class="line">        1、source&#x3D;&quot;get_field_name_display&quot;,在choice字段中可以展示选项对应的解释，这中用法代表的是官方解释说的可以是仅接受self参数的方法，也就是source中可以填serializer对象可以调用的方法（方法中需要传入self），内在逻辑是这个字段会展示此方法的返回的结果。</span><br><span class="line">        2、source&#x3D;&#39;user.email&#39;这种用法常在ModelSerializer的子类中，其中user为User对象，此中写法是指展示user的email属性，常用于我们想把外键对象user的属性和本对象的属性展示在同一层级，而不是下一级。</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    category &#x3D; serializers.CharField(source&#x3D;&#39;get_category_display&#39;, read_only&#x3D;True)</span><br><span class="line">    </span><br><span class="line">    # 外键关系的序列化是嵌套的序列化对象；内部通过外键关系的id找到publisher对象，再使用PublisherSerializer(publisher对象)</span><br><span class="line">    publisher &#x3D; PublisherSerializer(read_only&#x3D;True)         # 嵌套序列化器</span><br><span class="line">    authors &#x3D; AutherSerializer(many&#x3D;True, read_only&#x3D;True)   # 多对多关系需要加上参数：many &#x3D; True</span><br><span class="line">    </span><br><span class="line">    # read_only:指明该字段只做序列化，反序列化时不走该字段；那么反序列化时就必须重新指定字段名</span><br><span class="line">    # write_only:指明该字段只做反序列化，不做序列化,也就是从数据库读出来的数据，序列化返的时候，不显示某个字段</span><br><span class="line">    post_category &#x3D; serializers.IntegerField(write_only&#x3D;True)</span><br><span class="line">    publisher_id &#x3D; serializers.IntegerField(write_only&#x3D;True)</span><br><span class="line">    author_list &#x3D; serializers.ListField(write_only&#x3D;True)</span><br><span class="line">    </span><br><span class="line">    authors&#x3D;serializers.SerializerMethodField()           # 多对多时，自定义字段字段</span><br><span class="line">    def get_authors(self,obj):   # 名字固定写法</span><br><span class="line">        temp&#x3D;[]</span><br><span class="line">        for author in obj.authors.all():</span><br><span class="line">            temp.append(author.name)</span><br><span class="line">        return temp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def create(self, validated_data):</span><br><span class="line">        # 调用 save 时执行</span><br><span class="line">        # validated_data 校验通过的数据</span><br><span class="line">        # 通过ORM操作给Book表添加数据</span><br><span class="line">        # &#123;&#39;title&#39;: &#39;Die Hard&#39;, &#39;pub_time&#39;: datetime.date(2020, 1, 12), &#39;post_category&#39;: 1, &#39;publisher_id&#39;: 1, &#39;author_list&#39;: [1, 2]&#125;</span><br><span class="line">        book_obj &#x3D; Book.objects.create(</span><br><span class="line">            title&#x3D;validated_data[&#39;title&#39;],</span><br><span class="line">            pub_time&#x3D;validated_data[&#39;pub_time&#39;],</span><br><span class="line">            category&#x3D;validated_data[&#39;post_category&#39;],</span><br><span class="line">            publisher_id&#x3D;validated_data[&#39;publisher_id&#39;]</span><br><span class="line">        )</span><br><span class="line">        book_obj.authors.add(*validated_data[&#39;author_list&#39;])</span><br><span class="line">        return book_obj</span><br><span class="line"></span><br><span class="line">    def update(self, instance, validated_data):</span><br><span class="line">        # 调用 save 时执行</span><br><span class="line">        # instance为需要更新的对象</span><br><span class="line">        instance.title &#x3D; validated_data.get(&#39;title&#39;, instance.title)</span><br><span class="line">        instance.pub_time &#x3D; validated_data.get(&#39;pub_time&#39;, instance.pub_time)</span><br><span class="line">        instance.category &#x3D; validated_data.get(&#39;post_category&#39;, instance.category)</span><br><span class="line">        instance.publisher_id &#x3D; validated_data.get(&#39;publisher_id&#39;, instance.publisher_id)</span><br><span class="line">        if validated_data.get(&#39;author_list&#39;):</span><br><span class="line">            instance.authors.set(validated_data[&#39;author_list&#39;])</span><br><span class="line">        instance.save()</span><br><span class="line">        return instance</span><br></pre></td></tr></table></figure>
<h3 id="序列化组件is-valid、validated-data"><a href="#序列化组件is-valid、validated-data" class="headerlink" title="序列化组件is_valid、validated_data"></a>序列化组件is_valid、validated_data</h3><p>当我们定义好序列化器时，怎么校验传入的字段呢？那就是is_valid方法，可以根据定义序列化器的校验规则判断传入字段是否合法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">serializer &#x3D; CommentSerializer(data&#x3D;&#123;&#39;email&#39;: &#39;foobar&#39;, &#39;content&#39;: &#39;baz&#39;&#125;)</span><br><span class="line">serializer.is_valid()</span><br><span class="line"># False</span><br><span class="line">serializer.errors</span><br><span class="line"># &#123;&#39;email&#39;: [&#39;Enter a valid e-mail address.&#39;], &#39;created&#39;: [&#39;This field is required.&#39;]&#125;</span><br></pre></td></tr></table></figure>
<p>然后serializer.validated_data就可以获取校验过后的数据字典。</p>
<h3 id="序列化组件校验字段"><a href="#序列化组件校验字段" class="headerlink" title="序列化组件校验字段"></a>序列化组件校验字段</h3><p>序列化组件校验字段的方式常有三种：</p>
<p>1、首先是在字段的validators属性， 其中传入一个校验方法列表如：validators=(my_validator, )其中my_validator中定义校验规则。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def multiple_of_ten(value):</span><br><span class="line">    if value % 10 !&#x3D; 0:</span><br><span class="line">        raise serializers.ValidationError(&#39;Not a multiple of ten&#39;)</span><br><span class="line"></span><br><span class="line">class GameRecord(serializers.Serializer):</span><br><span class="line">    score &#x3D; IntegerField(validators&#x3D;[multiple_of_ten])</span><br></pre></td></tr></table></figure>
<p>2、最常用的是定义一个validate_field_name(self, value)的函数（其中field_name指的是字段名）,函数内是具体的逻辑。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from rest_framework import serializers</span><br><span class="line"></span><br><span class="line">class BlogPostSerializer(serializers.Serializer):</span><br><span class="line">    title &#x3D; serializers.CharField(max_length&#x3D;100)</span><br><span class="line">    content &#x3D; serializers.CharField()</span><br><span class="line"></span><br><span class="line">    def validate_title(self, value):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        Check that the blog post is about Django.</span><br><span class="line">        单个字段校验；value就是title的值</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        if &#39;django&#39; not in value.lower():</span><br><span class="line">            raise serializers.ValidationError(&quot;Blog post is not about Django&quot;)</span><br><span class="line">        return value</span><br></pre></td></tr></table></figure>
<p>3、最后一种是定义一个validate(self, data)其中data是所有字段的键值对，所以这个校验方法是对象级别的校验。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">from rest_framework import serializers</span><br><span class="line"></span><br><span class="line">class EventSerializer(serializers.Serializer):</span><br><span class="line">    description &#x3D; serializers.CharField(max_length&#x3D;100)</span><br><span class="line">    start &#x3D; serializers.DateTimeField()</span><br><span class="line">    finish &#x3D; serializers.DateTimeField()</span><br><span class="line"></span><br><span class="line">    def validate(self, data):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        Check that start is before finish.</span><br><span class="line">        多个字段校验；attrs是个字典，包含前端传递过来的所有字段</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        if data[&#39;start&#39;] &gt; data[&#39;finish&#39;]:</span><br><span class="line">            raise serializers.ValidationError(&quot;finish must occur after start&quot;)</span><br><span class="line">        return data</span><br></pre></td></tr></table></figure>
<p>当然或许当你看到这里会问why？how？ 只能说源码是最好的答案。</p>
<h4 id="validate做数据校验错误返回的key问题："><a href="#validate做数据校验错误返回的key问题：" class="headerlink" title="validate做数据校验错误返回的key问题："></a>validate做数据校验错误返回的key问题：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validate</span><span class="params">(self, attrs)</span>:</span></span><br><span class="line">    password = attrs.get(<span class="string">'password'</span>)</span><br><span class="line">    re_password = attrs.pop(<span class="string">'re_password'</span>)</span><br><span class="line">    print(password, re_password)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> password != re_password:</span><br><span class="line">        <span class="keyword">raise</span> serializers.ValidationError(<span class="string">'两次密码不一致'</span>)</span><br><span class="line">    <span class="keyword">return</span> attrs</span><br></pre></td></tr></table></figure>
<p>校验如有错误，报错的格式如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"status"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">"message"</span>: &#123;</span><br><span class="line">        <span class="string">"non_field_errors"</span>: [</span><br><span class="line">            <span class="string">"两次密码不一致"</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>message的key为non_field_errors，传递到前端不方便处理，可以自定义一个key</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">raise serializers.ValidationError(&#123;&#39;password&#39;: &#39;两次密码不一致&#39;&#125;)</span><br></pre></td></tr></table></figure>
<p>报错格式如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"status"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">"message"</span>: &#123;</span><br><span class="line">        <span class="string">"password"</span>: [</span><br><span class="line">            <span class="string">"两次密码不一致"</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="类视图"><a href="#类视图" class="headerlink" title="类视图"></a>类视图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">class BookView(APIView):</span><br><span class="line"></span><br><span class="line">    def get(self, request):</span><br><span class="line">        book_queryset &#x3D; Book.objects.all()</span><br><span class="line">        ser_obj &#x3D; BookSerializer(book_queryset, many &#x3D; True)</span><br><span class="line">        return Response(ser_obj.data)</span><br><span class="line"></span><br><span class="line">    def post(self, request):</span><br><span class="line">        book_obj &#x3D; request.data</span><br><span class="line">        # print(book_obj, type(book_obj))</span><br><span class="line">        ser_obj &#x3D; BookSerializer(data &#x3D; book_obj)</span><br><span class="line">        if ser_obj.is_valid():</span><br><span class="line">            # ser_obj.save()使用该方法时，序列化器中必须实例create()方法</span><br><span class="line">            ser_obj.save()</span><br><span class="line">            return Response(ser_obj.validated_data)</span><br><span class="line">        return Response(ser_obj.errors)</span><br><span class="line"></span><br><span class="line">class BookEditView(APIView):</span><br><span class="line"></span><br><span class="line">    def get(self, request, id):</span><br><span class="line">        book_obj &#x3D; Book.objects.filter(id &#x3D; id).first()</span><br><span class="line">        ser_obj &#x3D; BookSerializer(book_obj)</span><br><span class="line">        return Response(ser_obj.data)</span><br><span class="line"></span><br><span class="line">    def put(self, request, id):</span><br><span class="line">        book_obj &#x3D; Book.objects.filter(id&#x3D;id).first()</span><br><span class="line">        # partial&#x3D;True 指明为部分字段做校验，即传入什么字段就校验什么字段，其他字段不做校验</span><br><span class="line">        ser_obj &#x3D; BookSerializer(instance &#x3D; book_obj, data &#x3D; request.data, partial &#x3D; True)</span><br><span class="line">        if ser_obj.is_valid():</span><br><span class="line">            ser_obj.save()</span><br><span class="line">            return Response(ser_obj.validated_data)</span><br><span class="line">        return Response(ser_obj.errors)</span><br></pre></td></tr></table></figure>
<h3 id="serializers-Serializer序列总结"><a href="#serializers-Serializer序列总结" class="headerlink" title="serializers.Serializer序列总结"></a>serializers.Serializer序列总结</h3><p>使用serializers.Serializer方法序列化时注意以下几点：  </p>
<ol>
<li>正序与反序字段不一致  </li>
<li>字段中的参数 required=False 指明反序时（前端提交数据过来）不做数据校验  </li>
<li>read_only=True 参数指明该字段只做序列化，反序列化时不走该字段；那么反序列化时就必须重新指定字段名  </li>
<li>write_only 参数指明该字段只用做反序列化  </li>
<li>序列化器中必须实现create()与update()方法，分别对应创建与更新  </li>
<li>前端提交的参数校验与Django中的form表单校验数据一样</li>
</ol>
<h2 id="seriarizers-ModelSerializer序列化"><a href="#seriarizers-ModelSerializer序列化" class="headerlink" title="seriarizers.ModelSerializer序列化"></a>seriarizers.ModelSerializer序列化</h2><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><h3 id="4-1-depth"><a href="#4-1-depth" class="headerlink" title="4.1 depth"></a>4.1 depth</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 只修改了book表的序列化器，其他文件不动</span><br><span class="line">class BookSerializer(serializers.ModelSerializer):</span><br><span class="line">    class Meta:</span><br><span class="line">        model &#x3D; Book</span><br><span class="line">        fields &#x3D; &#39;__all__&#39;</span><br></pre></td></tr></table></figure>
<p>序列化后的数据如下：  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"id"</span>:<span class="number">2</span>,</span><br><span class="line">    <span class="string">"title"</span>: <span class="string">"天龙八部"</span>,</span><br><span class="line">    <span class="string">"authors"</span>: [</span><br><span class="line">        <span class="number">1</span>,</span><br><span class="line">        <span class="number">2</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>外键关联的字段只显示了id，添加一个depth参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class BookSerializer(serializers.ModelSerializer):</span><br><span class="line">    class Meta:</span><br><span class="line">        model &#x3D; Book</span><br><span class="line">        fields &#x3D; &#39;__all__&#39;</span><br><span class="line">        depth &#x3D; 1</span><br></pre></td></tr></table></figure>
<p>序列化后的数据如下：  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"id"</span>:<span class="number">2</span>,</span><br><span class="line">    <span class="string">"title"</span>: <span class="string">"天龙八部"</span>,</span><br><span class="line">    <span class="string">"authors"</span>: [</span><br><span class="line">        &#123;<span class="string">"id"</span>:<span class="number">1</span> , <span class="string">"name"</span>: <span class="string">"a"</span>&#125;,</span><br><span class="line">        &#123;<span class="string">"id"</span>:<span class="number">2</span> , <span class="string">"name"</span>: <span class="string">"b"</span>&#125;,</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>depth=1，意为找到一层关联的数据，即找到publisher关联表，如果publisher中有还有关联的表，不会再往下去找。  </p>
<p>注意：</p>
<ol>
<li>depth最多不要超过四层</li>
<li>depth会让所有的外键关系字段变成read_only=True</li>
<li>生产环境depth不常用</li>
</ol>
<h3 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">class BookSerializer(serializers.ModelSerializer):</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        model &#x3D; Book</span><br><span class="line">        fields &#x3D; &#39;__all__&#39;</span><br><span class="line">        # exclude &#x3D; [&#39;id&#39;]</span><br><span class="line">        # depth &#x3D; 1   # 注意： depth会让所有的外键关系字段变成read_only&#x3D;True</span><br><span class="line">        extra_kwargs &#x3D; &#123;</span><br><span class="line">            &#39;publisher&#39;: &#123;&#39;write_only&#39;: True&#125;,</span><br><span class="line">            &#39;authors&#39;: &#123;&#39;write_only&#39;: True&#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    # 重写正序字段</span><br><span class="line">    publisher_info &#x3D; serializers.SerializerMethodField(read_only&#x3D;True)</span><br><span class="line">    # SerializerMethodField是一个方法字段，即需要一个方法的返回值再赋给该字段</span><br><span class="line">    authors_info &#x3D; serializers.SerializerMethodField(read_only&#x3D;True)</span><br><span class="line"></span><br><span class="line">    def get_publisher_info(self, obj):</span><br><span class="line">        publisher_obj &#x3D; obj.publisher</span><br><span class="line">        print(publisher_obj)</span><br><span class="line">        return &#123;&#39;id&#39;: publisher_obj.id, &#39;title&#39;: publisher_obj.title&#125;</span><br><span class="line">    def get_authors_info(self, obj):</span><br><span class="line">        authors_queryset &#x3D; obj.authors.all()</span><br><span class="line">        return [&#123;&#39;id&#39;: author.id, &#39;name&#39;: author.name&#125; for author in authors_queryset]</span><br></pre></td></tr></table></figure>
<p>外键关联的字段正序使用的是publisher_info与authors_info，那么反序还是使用的publisher与authors字段。字段的校验与上面的一样。</p>
<h3 id="自定义序列字段的两种写法"><a href="#自定义序列字段的两种写法" class="headerlink" title="自定义序列字段的两种写法"></a>自定义序列字段的两种写法</h3><p>这里所说的自定义序列字段可以另一张表中的字段，也可以自定要序列化的字段，也可以是外键关联的字段。<br>这种字段可以使用serializers.SerializerMethodField方法写在序列化器中<br>也可以在模型类中定义方法  </p>
<p>1：写在序列化器中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class BookSerializer(serializers.ModelSerializer):</span><br><span class="line">    publisher &#x3D; serializers.SerializerMethodField()</span><br><span class="line"></span><br><span class="line">    def get_publisher(self, obj):</span><br><span class="line">        return obj.publisher.name</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        model &#x3D; Book</span><br><span class="line">        fields &#x3D; [&#39;name&#39;, &#39;price&#39;, &#39;publisher&#39;]</span><br></pre></td></tr></table></figure>
<p>注意：使用serializers.SerializerMethodField方法时，在fields列表中必须写上该字段，如上面代码中的publisher。如果fields列表中没有指定publiser字段，会报如下异常：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The field &#39;publisher&#39; was declared on serializer BookSerializer, but has not been included in the &#39;fields&#39; option.</span><br></pre></td></tr></table></figure>
<p>2：写在模型类中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class Book(BaseModel):</span><br><span class="line">    name &#x3D; models.CharField(max_length&#x3D;64)</span><br><span class="line">    price &#x3D; models.DecimalField(max_digits&#x3D;5, decimal_places&#x3D;2)</span><br><span class="line">    img &#x3D; models.ImageField(upload_to&#x3D;&#39;img&#39;, default&#x3D;&#39;img&#x2F;default.jpg&#39;)</span><br><span class="line">    publisher &#x3D; models.ForeignKey(to&#x3D;&#39;Publisher&#39;, on_delete&#x3D;models.CASCADE)</span><br><span class="line">    authors &#x3D; models.ManyToManyField(to&#x3D;&#39;Author&#39;)</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        db_table &#x3D; &#39;gin_book&#39;</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.name</span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    def publisher_name(self):           # 定义成一个方法属性，方法名与属性名不能重复</span><br><span class="line">        return self.publisher.name</span><br></pre></td></tr></table></figure>
<p>序列化类中的fields列表，可以指定publisher_name；不指定也不报异常</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class BookSerializer(serializers.ModelSerializer):</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        model &#x3D; Book</span><br><span class="line">        fields &#x3D; [&#39;name&#39;, &#39;price&#39;, &#39;publisher_name&#39;]	# 不指定publisher_name字段不会抛异常</span><br></pre></td></tr></table></figure>
<p>使用该方法时反序列化如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class BookSerializer(serializers.ModelSerializer):</span><br><span class="line">    class Meta:</span><br><span class="line">        model &#x3D; Book</span><br><span class="line">        fields &#x3D; [&#39;name&#39;, &#39;price&#39;, &#39;publisher_name&#39;, &#39;img&#39;, &#39;author_list&#39;, &#39;publisher&#39;, &#39;authors&#39;]</span><br><span class="line">        extra_kwargs &#x3D; &#123;</span><br><span class="line">            &#39;publisher&#39;: &#123;&#39;write_only&#39;: True&#125;,</span><br><span class="line">            &#39;authors&#39;: &#123;&#39;write_only&#39;: True&#125;,</span><br><span class="line">            &#39;name&#39;: &#123;</span><br><span class="line">                &#39;required&#39;: True,</span><br><span class="line">                &#39;min_length&#39;: 3,</span><br><span class="line">                &#39;error_messages&#39;: &#123;</span><br><span class="line">                    &#39;required&#39;: &#39;必填项&#39;,</span><br><span class="line">                    &#39;min_length&#39;: &#39;至少3个字符&#39;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>视图类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class BooksView(APIView):</span><br><span class="line">    def get(self, request):</span><br><span class="line">        queryset &#x3D; Book.objects.filter(is_delete &#x3D; False)</span><br><span class="line">        serializer &#x3D; BookSerializer(queryset, many &#x3D; True)</span><br><span class="line">        return Response(serializer.data)</span><br><span class="line">    def post(self, request):</span><br><span class="line">        ser_obj &#x3D; BookSerializer(data &#x3D; request.data)</span><br><span class="line">        ser_obj.is_valid(raise_exception&#x3D;True)  # 当校验失败会马上终止当前视图方法，抛出异常给前台</span><br><span class="line">        book_obj &#x3D; ser_obj.save()</span><br><span class="line">        return Response(&#123;&#39;status&#39;: 0, &#39;message&#39;: &#39;OK&#39;, &#39;result&#39;: BookSerializer(book_obj).data&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="自定义联表深度（嵌套）"><a href="#自定义联表深度（嵌套）" class="headerlink" title="自定义联表深度（嵌套）"></a>自定义联表深度（嵌套）</h3><p>模型类如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class Book(BaseModel):</span><br><span class="line">    name &#x3D; models.CharField(max_length&#x3D;64)</span><br><span class="line">    price &#x3D; models.DecimalField(max_digits&#x3D;5, decimal_places&#x3D;2)</span><br><span class="line">    img &#x3D; models.ImageField(upload_to&#x3D;&#39;img&#39;, default&#x3D;&#39;img&#x2F;default.jpg&#39;)</span><br><span class="line">    publisher &#x3D; models.ForeignKey(to&#x3D;&#39;Publisher&#39;, on_delete&#x3D;models.CASCADE)</span><br><span class="line">    authors &#x3D; models.ManyToManyField(to&#x3D;&#39;Author&#39;)</span><br><span class="line">    class Meta:</span><br><span class="line">        db_table &#x3D; &#39;gin_book&#39;</span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.name</span><br><span class="line"></span><br><span class="line">class Publisher(BaseModel):</span><br><span class="line">    name &#x3D; models.CharField(max_length&#x3D;64)</span><br><span class="line">    address &#x3D; models.CharField(max_length&#x3D;64)</span><br><span class="line">    class Meta:</span><br><span class="line">        db_table &#x3D; &#39;gin_publisher&#39;</span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.name</span><br></pre></td></tr></table></figure>
<p>需求：Book表序列化时，也要序列化Pulisher表中指定的字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class PublisherSerializer(serializers.ModelSerializer):</span><br><span class="line">    class Meta:</span><br><span class="line">        model &#x3D; Publisher</span><br><span class="line">        fields &#x3D; [&#39;name&#39;, &#39;address&#39;]</span><br><span class="line"></span><br><span class="line">class BookSerializer(serializers.ModelSerializer):</span><br><span class="line">    # 自定义连表深度 - 子序列化方式</span><br><span class="line">    publisher &#x3D; PublisherSerializer()</span><br><span class="line">    class Meta:</span><br><span class="line">        model &#x3D; Book</span><br><span class="line">        fields &#x3D; [&#39;name&#39;, &#39;price&#39;, &#39;publisher&#39;]</span><br></pre></td></tr></table></figure>
<p><img src="picture/1629438957-c24132aedb596049b26f0f597e1e1039.png" alt="Django Rest Framework之序列化器"></p>
<h3 id="单增群增"><a href="#单增群增" class="headerlink" title="单增群增"></a>单增群增</h3><p>序列化器如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">class BookSerializer(serializers.ModelSerializer):</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        model &#x3D; Book</span><br><span class="line">        fields &#x3D; [&#39;name&#39;, &#39;price&#39;, &#39;publisher_name&#39;, &#39;img&#39;, &#39;author_list&#39;, &#39;publisher&#39;, &#39;authors&#39;]</span><br><span class="line">        extra_kwargs &#x3D; &#123;</span><br><span class="line">            &#39;publisher&#39;: &#123;&#39;write_only&#39;: True&#125;,</span><br><span class="line">            &#39;authors&#39;: &#123;&#39;write_only&#39;: True&#125;,</span><br><span class="line">            &#39;name&#39;: &#123;</span><br><span class="line">                &#39;required&#39;: True,</span><br><span class="line">                &#39;min_length&#39;: 3,</span><br><span class="line">                &#39;error_messages&#39;: &#123;</span><br><span class="line">                    &#39;required&#39;: &#39;必填项&#39;,</span><br><span class="line">                    &#39;min_length&#39;: &#39;至少3个字符&#39;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    def validate_name(self, value):</span><br><span class="line">        if Book.objects.filter(name &#x3D; value).exists():</span><br><span class="line">            raise serializers.ValidationError(&#39;书籍名已存在&#39;)</span><br><span class="line">        return value</span><br><span class="line"></span><br><span class="line">    def validate(self, attrs):</span><br><span class="line">        # todo: do something</span><br><span class="line">        return attrs</span><br></pre></td></tr></table></figure>
<p>单增群增，序列化器不用改。但需要判断前台数据为字典时为单增，为列表时是群增</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class BooksView(APIView):</span><br><span class="line">    def get(self, request):</span><br><span class="line">        queryset &#x3D; Book.objects.filter(is_delete&#x3D;False)</span><br><span class="line">        serializer &#x3D; BookSerializer(queryset, many&#x3D;True)</span><br><span class="line">        return Response(serializer.data)</span><br><span class="line"></span><br><span class="line">    def post(self, request):</span><br><span class="line">        if isinstance(request.data, dict):</span><br><span class="line">            many &#x3D; False</span><br><span class="line">        elif isinstance(request.data, list):</span><br><span class="line">            many &#x3D; True</span><br><span class="line">        else:</span><br><span class="line">            return Response(&#123;&#39;status&#39;: 1, &#39;message&#39;: &#39;invalid data&#39;&#125;)</span><br><span class="line"></span><br><span class="line">        ser_obj &#x3D; BookSerializer(data&#x3D;request.data, many&#x3D;many)</span><br><span class="line">        ser_obj.is_valid(raise_exception&#x3D;True)  # 当校验失败会马上终止当前视图方法，抛出异常给前台</span><br><span class="line">        results &#x3D; ser_obj.save()</span><br><span class="line">        return Response(&#123;&#39;status&#39;: 0, &#39;message&#39;: &#39;OK&#39;, &#39;result&#39;: BookSerializer(results, many&#x3D;many).data&#125;)</span><br></pre></td></tr></table></figure>
<p>前台传递数据格式如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">	&#123;</span><br><span class="line">	    <span class="string">"name"</span>: <span class="string">"better man"</span>,</span><br><span class="line">	    <span class="string">"price"</span>: <span class="number">96.66</span>,</span><br><span class="line">	    <span class="string">"authors"</span>: [<span class="number">1</span>,<span class="number">3</span>],</span><br><span class="line">	    <span class="string">"publisher"</span>: <span class="number">1</span></span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">"name"</span>: <span class="string">"tomorrow will be better"</span>,</span><br><span class="line">		<span class="string">"price"</span>: <span class="number">100</span>,</span><br><span class="line">		<span class="string">"authors"</span>: [<span class="number">2</span>],</span><br><span class="line">		<span class="string">"publisher"</span>: <span class="number">2</span></span><br><span class="line">	&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="单删群删"><a href="#单删群删" class="headerlink" title="单删群删"></a>单删群删</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def delete(self, request, *args, **kwargs):</span><br><span class="line">    pk &#x3D; kwargs.get(&#39;pk&#39;)</span><br><span class="line">    if pk:</span><br><span class="line">        pks &#x3D; [pk]		# 单删在URL中传递主键id</span><br><span class="line">    else:</span><br><span class="line">        pks &#x3D; request.data.get(&#39;pks&#39;)	# 群删传递JSON数据：&#123;&#39;pks&#39;: [2,4,5,6]&#125;</span><br><span class="line">    if Book.objects.filter(pk__in &#x3D; pks, is_delete &#x3D; False).update(is_delete &#x3D; True):</span><br><span class="line">        return Response(&#123;&#39;status&#39;: 0, &#39;message&#39;: &#39;success&#39;&#125;)</span><br><span class="line">    return Response(&#123;&#39;status&#39;: 0, &#39;message&#39;: &#39;failed&#39;&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据"></a>修改数据</h3><p>1：单整体修改<br>即修改数据时所传递的数据字段不能少</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def put(self, request, pk):</span><br><span class="line">    book_obj &#x3D; Book.objects.filter(pk &#x3D; pk).first()</span><br><span class="line">    serializer &#x3D; BookSerializer(instance &#x3D; book_obj, data &#x3D; request.data)</span><br><span class="line">    # 有 instance &#x3D; book_obj 参数，当serializer.save()时会走update方法；如果没有instance &#x3D; book_obj 参数会走create方法</span><br><span class="line">    # data &#x3D; request.data 必须要有，因为下面的is_valid方法校验的就是data中的数据</span><br><span class="line">    serializer.is_valid(raise_exception&#x3D;True)</span><br><span class="line">    book &#x3D; serializer.save()</span><br><span class="line">    return Response(BookSerializer(book).data, status &#x3D; status.HTTP_201_CREATED)</span><br></pre></td></tr></table></figure>
<p>前端传递数据如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">"name"</span>: <span class="string">"take me to you heart"</span>,</span><br><span class="line">	<span class="string">"price"</span>: <span class="number">68.3</span>,</span><br><span class="line">	<span class="string">"publisher"</span>: <span class="number">1</span>,</span><br><span class="line">	<span class="string">"authors"</span>: [<span class="number">1</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2：单局部修改<br>即前端只传递部分字段，传递过来的字段做数据校验，校验通过后更新；没传递过来的字段不做数据校验</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def patch(self, request, pk):</span><br><span class="line">    book_obj &#x3D; Book.objects.filter(pk&#x3D;pk).first()</span><br><span class="line">    # 方法同上，只是多了个 partial&#x3D;True 参数；即传递过来的字段做校验，没有传递过来的字段不做校验</span><br><span class="line">    serializer &#x3D; BookSerializer(instance&#x3D;book_obj, data&#x3D;request.data, partial&#x3D;True)</span><br><span class="line">    serializer.is_valid(raise_exception&#x3D;True)</span><br><span class="line">    book &#x3D; serializer.save()</span><br><span class="line">    return Response(BookSerializer(book).data, status&#x3D;status.HTTP_201_CREATED)</span><br></pre></td></tr></table></figure>
<h3 id="批量修改数据"><a href="#批量修改数据" class="headerlink" title="批量修改数据"></a>批量修改数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">class BooksAPIView(APIView):</span><br><span class="line">	........................</span><br><span class="line">    # 请求数据格式：[&#123;pk:1, name: 123&#125;, &#123;&#125;, &#123;&#125;]</span><br><span class="line">    def patch(self, request, *args, **kwargs):</span><br><span class="line">        request_data &#x3D; request.data</span><br><span class="line">        pk &#x3D; kwargs.get(&#39;pk&#39;)</span><br><span class="line">        if pk and isinstance(request_data, dict):</span><br><span class="line">            # 单改</span><br><span class="line">            pks &#x3D; [pk]</span><br><span class="line">            request_data &#x3D; [request.data]</span><br><span class="line">        elif not pk and isinstance(request_data, list):</span><br><span class="line">            # 群改</span><br><span class="line">            pks &#x3D; []</span><br><span class="line">            for dic in request_data:</span><br><span class="line">                pk &#x3D; dic.pop(&#39;pk&#39;, None)</span><br><span class="line">                pks.append(pk)</span><br><span class="line">            if not pks:</span><br><span class="line">                return Response(&#123;&#39;status&#39;: 1, &#39;message&#39;: &#39;invalid data&#39;, &#39;result&#39;: &#39;&#39;&#125;)</span><br><span class="line">        else:</span><br><span class="line">            return Response(&#123;&#39;status&#39;: 1, &#39;message&#39;: &#39;invalid data&#39;, &#39;result&#39;: &#39;&#39;&#125;)</span><br><span class="line">        objs &#x3D; []</span><br><span class="line">        new_request_data &#x3D; []</span><br><span class="line"></span><br><span class="line">        for index, pk in enumerate(pks):</span><br><span class="line">            try:</span><br><span class="line">                obj &#x3D; Book.objects.get(pk &#x3D; pk, is_delete &#x3D; False)</span><br><span class="line">                objs.append(obj)</span><br><span class="line">                new_request_data.append(request_data[index])</span><br><span class="line">            except Exception as e:</span><br><span class="line">                continue</span><br><span class="line">        print(objs)</span><br><span class="line">        print(new_request_data)</span><br><span class="line">        book_ser &#x3D; BookSerializer(instance &#x3D; objs, data &#x3D; new_request_data, partial &#x3D; True, many &#x3D; True)</span><br><span class="line">        book_ser.is_valid(raise_exception&#x3D;True)</span><br><span class="line">        book_obj &#x3D; book_ser.save()</span><br><span class="line">        return Response(&#123;&#39;status&#39;: 1, &#39;message&#39;: &#39;success&#39;, &#39;result&#39;: BookSerializer(book_obj, many &#x3D; True).data&#125;)</span><br></pre></td></tr></table></figure>
<p>注意：批量修改数据，序列化器中必须要有ListSerializer，如果没有会抛出异常：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NotImplementedError: Serializers with many&#x3D;True do not support multiple update by default, only multiple create. For updates it is unclear how to deal with insertions and deletions. If you need to support multiple update, use a &#96;ListSerializer&#96; class and override &#96;.update()&#96; so you can specify the behavior exactly.</span><br></pre></td></tr></table></figure>
<p>序列化类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># ListSerializer与ModelSerializer建立关联的是：ModelSerializer的Meta类的 list_serializer_class</span><br><span class="line">class BookListSerializer(serializers.ListSerializer):</span><br><span class="line">    def update(self, instance, validated_data):</span><br><span class="line">        print(instance)         # 要更新的对象们</span><br><span class="line">        print(self.child)       # 服务的模型序列化类（BookSerializer）</span><br><span class="line"></span><br><span class="line">        for index, obj in enumerate(instance):</span><br><span class="line">            self.child.update(obj, validated_data[index])</span><br><span class="line">        return instance</span><br><span class="line"></span><br><span class="line">class BookSerializer(serializers.ModelSerializer):</span><br><span class="line">    class Meta:</span><br><span class="line">        model &#x3D; Book</span><br><span class="line">        fields &#x3D; [&#39;name&#39;, &#39;price&#39;, &#39;publisher&#39;, &#39;img&#39;, &#39;author_list&#39;, &#39;publisher_name&#39;, &#39;authors&#39;]</span><br><span class="line">        extra_kwargs &#x3D; &#123;</span><br><span class="line">            &#39;name&#39;: &#123;&#39;required&#39;: True, &#39;min_length&#39;: 1, &#39;error_messages&#39;: &#123;&#39;required&#39;: &#39;必填项&#39;, &#39;min_length&#39;: &#39;至少3个字符&#39;&#125;&#125;,</span><br><span class="line">            &#39;publisher&#39;: &#123;&#39;write_only&#39;: True&#125;,</span><br><span class="line">            &#39;authors&#39;: &#123;&#39;write_only&#39;: True&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        list_serializer_class &#x3D; BookListSerializer</span><br></pre></td></tr></table></figure>
<h3 id="视图类与序列化类传参"><a href="#视图类与序列化类传参" class="headerlink" title="视图类与序列化类传参"></a>视图类与序列化类传参</h3><p>在视图类中，可以通过request得到登陆用户request.user<br>在序列化类中，要完成数据库数据的校验与入库操作，可能会需要知道当前的登录用户，但序列化类无法访问request对象<br>在视图类中实例化序列化对象时，可以通过context参数将request对象传递进去</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">book_ser &#x3D; BookSerializer(context &#x3D; &#123;&#39;request&#39;: request&#125;, instance &#x3D; objs, data &#x3D; new_request_data, partial &#x3D; True, many &#x3D; True)</span><br></pre></td></tr></table></figure>
<p>序列化类中可以在钩子函数中接受该参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class BookSerializer(serializers.ModelSerializer):</span><br><span class="line">    class Meta:</span><br><span class="line">        model &#x3D; Book</span><br><span class="line">        fields &#x3D; [&#39;name&#39;, &#39;price&#39;, &#39;publisher&#39;, &#39;img&#39;, &#39;author_list&#39;, &#39;publisher_name&#39;, &#39;authors&#39;]</span><br><span class="line">        extra_kwargs &#x3D; &#123;</span><br><span class="line">            &#39;name&#39;: &#123;&#39;required&#39;: True, &#39;min_length&#39;: 1, &#39;error_messages&#39;: &#123;&#39;required&#39;: &#39;必填项&#39;, &#39;min_length&#39;: &#39;至少3个字符&#39;&#125;&#125;,</span><br><span class="line">            &#39;publisher&#39;: &#123;&#39;write_only&#39;: True&#125;,</span><br><span class="line">            &#39;authors&#39;: &#123;&#39;write_only&#39;: True&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        list_serializer_class &#x3D; BookListSerializer</span><br><span class="line"></span><br><span class="line">    def validate(self, attrs):</span><br><span class="line">        print(self.context.get(&#39;request&#39;).method)</span><br><span class="line">        return attrs</span><br></pre></td></tr></table></figure>
<h2 id="序列化组件修改返回值to-representation、to-internal-value"><a href="#序列化组件修改返回值to-representation、to-internal-value" class="headerlink" title="序列化组件修改返回值to_representation、to_internal_value"></a>序列化组件修改返回值to_representation、to_internal_value</h2><p>to_representation(self, instance)：如果序列化器定义了此方法，可以改变序列化对象data的值，也就是serializer.data的值，你可以根据自己的业务场景去重新构造返回值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def to_representation(self, instance):</span><br><span class="line">    &quot;&quot;&quot;Convert &#96;username&#96; to lowercase.&quot;&quot;&quot;</span><br><span class="line">    ret &#x3D; super().to_representation(instance)</span><br><span class="line">    ret[&#39;username&#39;] &#x3D; ret[&#39;username&#39;].lower()</span><br><span class="line">    return ret</span><br></pre></td></tr></table></figure>
<p>to_internal_value(self, data)： data为未经校验的数据字段， 此方法可以实现校验和修改反序列化后的值，然后返回。如果不想修改反序列化后的值只是做校验的话，完全可以使用validate方法替代。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def to_internal_value(self, value):</span><br><span class="line">    if value &#x3D;&#x3D; None:</span><br><span class="line">        return 0</span><br><span class="line">    return value</span><br></pre></td></tr></table></figure>
<p>总而言之，这两个方法一个是用于重新构造validated_data并返回，一个用于重新构造serializer.data的值并返回。</p>
<ul>
<li><a href="https://www.cnblogs.com/yoyoketang/p/14347488.html" target="_blank" rel="noopener">python测试开发django-rest-framework-91.反序列化(ModelSerializer)之ChoiceField选项字段校验</a></li>
<li><a href="https://blog.csdn.net/pcn01/article/details/103952474" target="_blank" rel="noopener">Django Rest Framework之序列化</a></li>
</ul>

                
                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2021/08/18/lepeng-python-Django-REST-framework-Django-REST-framework-频率组件/" data-toggle="tooltip" data-placement="top" title="Django REST framework 认证和权限组件">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2021/08/11/lepeng-nodejs-vue-拦截器/" data-toggle="tooltip" data-placement="top" title="vue 拦截器">Next Post &rarr;</a>
                    </li>
                    
                </ul>

                <!-- tip start -->
                

                
                <div class="comment_notes">
                    <p>
                        study well and make progress every day; study well and progress every day; study hard and make progress every day.
                    </p>
                </div>
                
                <!-- tip end -->

                <!-- Music start-->
                
                <!-- Music end -->

                <!-- Sharing -->
                
                <div class="social-share"  data-wechat-qrcode-helper="" align="center"></div>
                <!--  css & js -->
                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
                <script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
                
                <!-- Sharing -->

                <!-- gitment start -->
                
                <!-- gitment end -->

                <!-- 来必力City版安装代码 -->
                
                <!-- City版安装代码已完成 -->

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->
            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

    
      
        <aside id="sidebar">
          <div id="toc" class="toc-article">
          <strong class="toc-title">Contents</strong>
          
            
              <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#简介"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">简介</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#简单示例"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">简单示例</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#models部分"><span class="toc-nav-number">2.1.</span> <span class="toc-nav-text">models部分:</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#views部分："><span class="toc-nav-number">2.2.</span> <span class="toc-nav-text">views部分：</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#方式三：BookSerializers"><span class="toc-nav-number">2.3.</span> <span class="toc-nav-text">方式三：BookSerializers</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#方式四：ModelSerializer"><span class="toc-nav-number">2.4.</span> <span class="toc-nav-text">方式四：ModelSerializer</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#序列化组件常用字段"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">序列化组件常用字段</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#source"><span class="toc-nav-number">4.</span> <span class="toc-nav-text">source</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#serializers-Serializer序列化"><span class="toc-nav-number">5.</span> <span class="toc-nav-text">serializers.Serializer序列化</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#数据模型"><span class="toc-nav-number">5.1.</span> <span class="toc-nav-text">数据模型</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#创建序列化器"><span class="toc-nav-number">5.2.</span> <span class="toc-nav-text">创建序列化器</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#序列化组件is-valid、validated-data"><span class="toc-nav-number">5.3.</span> <span class="toc-nav-text">序列化组件is_valid、validated_data</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#序列化组件校验字段"><span class="toc-nav-number">5.4.</span> <span class="toc-nav-text">序列化组件校验字段</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#validate做数据校验错误返回的key问题："><span class="toc-nav-number">5.4.1.</span> <span class="toc-nav-text">validate做数据校验错误返回的key问题：</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#类视图"><span class="toc-nav-number">5.5.</span> <span class="toc-nav-text">类视图</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#serializers-Serializer序列总结"><span class="toc-nav-number">5.6.</span> <span class="toc-nav-text">serializers.Serializer序列总结</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#seriarizers-ModelSerializer序列化"><span class="toc-nav-number">6.</span> <span class="toc-nav-text">seriarizers.ModelSerializer序列化</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">6.1.</span> <span class="toc-nav-text">示例</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#4-1-depth"><span class="toc-nav-number">6.2.</span> <span class="toc-nav-text">4.1 depth</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#反序列化"><span class="toc-nav-number">6.3.</span> <span class="toc-nav-text">反序列化</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#自定义序列字段的两种写法"><span class="toc-nav-number">6.4.</span> <span class="toc-nav-text">自定义序列字段的两种写法</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#自定义联表深度（嵌套）"><span class="toc-nav-number">6.5.</span> <span class="toc-nav-text">自定义联表深度（嵌套）</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#单增群增"><span class="toc-nav-number">6.6.</span> <span class="toc-nav-text">单增群增</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#单删群删"><span class="toc-nav-number">6.7.</span> <span class="toc-nav-text">单删群删</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#修改数据"><span class="toc-nav-number">6.8.</span> <span class="toc-nav-text">修改数据</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#批量修改数据"><span class="toc-nav-number">6.9.</span> <span class="toc-nav-text">批量修改数据</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#视图类与序列化类传参"><span class="toc-nav-number">6.10.</span> <span class="toc-nav-text">视图类与序列化类传参</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#序列化组件修改返回值to-representation、to-internal-value"><span class="toc-nav-number">7.</span> <span class="toc-nav-text">序列化组件修改返回值to_representation、to_internal_value</span></a></li></ol>
            
          
          </div>
        </aside>
      
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#Python" title="Python">Python</a>
                        
                          <a class="tag" href="/tags/#Django" title="Django">Django</a>
                        
                          <a class="tag" href="/tags/#DRF" title="DRF">DRF</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="https://blog.csdn.net/fenglepeng" target="_blank">Feng Lepeng&#39;s CSDN</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>


<style  type="text/css">
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">

                

                

                

                

                

                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy;
                    <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener">京ICP备18055501号-2</a>;
                    Feng Lepeng 2022
                    <br>
                    Powered by 
                    <a href="https://github.com/dusign/hexo-theme-snail" target="_blank" rel="noopener">
                        <i>hexo-theme-snail</i>
                    </a> | 
                    <iframe name="star" style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0"
                        width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=flepeng&repo=hexo-theme-lp&type=star">
                    </iframe>
                </p>
            </div>
        </div>
    </div>

</footer>

<!-- jQuery -->

<script src="/js/jquery.min.js"></script>


<!-- Bootstrap Core JavaScript -->

<script src="/js/bootstrap.min.js"></script>


<!-- Custom Theme JavaScript -->

<script src="/js/hux-blog.min.js"></script>


<!-- Search -->

<script src="/js/search.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://flepeng.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-XXXXXXXX-X';
    var _gaDomain = 'yoursite';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->


<!-- Search -->

    <script type="text/javascript">      
        var search_path = "search.xml";
        if (search_path.length == 0) {
            search_path = "search.xml";
        }
    var path = "/" + search_path;
    searchFunc(path, 'local-search-input', 'local-search-result');
    </script>


<!-- busuanzi -->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>

    
        <!-- background effects line -->
        

        
            <script type="text/javascript" src="/js/mouse-click.js" content='[&#34;🌱&#34;,&#34;just do it&#34;,&#34;🍀&#34;]' color='[&#34;rgb(121,93,179)&#34; ,&#34;rgb(76,180,231)&#34; ,&#34;rgb(184,90,154)&#34;]'></script>
        

        <!-- background effects end -->
    

    <!--<script size="50" alpha='0.3' zIndex="-999" src="/js/ribbonStatic.js"></script>-->
    
        <script src="/js/ribbonDynamic.js"></script>
    
</body>

</html>
